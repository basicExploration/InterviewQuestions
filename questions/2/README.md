## 问

电商交易系统中，订单数据一般都会很大，我们一般都分库分表来存储。假设我们分了10个库并存储在不同的机器上，在不引入复杂的分库分表中间件的情 况下，我们希望开发一个小的功能，能够快速地查询金额最大的前K个订单(K是输入参数，可能是1、10、1000、10000，假设最大不会超过10万)。如果你
是这个功能的设计开发负责人，你会如何设计一个比较详细的、可以落地执行的设计方案呢?

为了方便你设计，我先交代一些必要的背景，在设计过程中，如果有其他需要明确的背景，你可以自行假设。

数据库中，订单表的金额字段上建有索引，我们可以通过select order by limit语句来获取数据库中的数据;

我们的机器的可用内存有限，比如只有几百M剩余可用内存。希望你的设计尽量节省内存，不要发生Out of Memory Error。

## 答

我们需要一个数据库，一个优先级队列（最小堆）

首先我们有10个数据库，我们使用 `SELECT ORDER BY LIMIT`语句把最大的数据取出来，（最好一次取多一点比如前10个 20个的数据取出来）然后组成一个优先队列，然后删除堆顶，然后这么来k次就行了。这里有个队列结束了都不到k怎么办，那就是你刚开始从数据库中取的值指定的太少了。

> 这个地方可以把最小堆换成快速选择。
